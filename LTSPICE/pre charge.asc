Version 4
SHEET 1 1296 1488
WIRE 1136 208 1136 192
WIRE 912 224 912 208
WIRE 304 304 304 160
WIRE 416 304 304 304
WIRE 1136 320 1136 288
WIRE 416 368 416 304
WIRE 448 368 416 368
WIRE 752 368 752 304
WIRE 752 368 640 368
WIRE 1008 368 752 368
WIRE 1008 384 1008 368
WIRE 912 400 912 304
WIRE 976 400 912 400
WIRE 1136 416 1136 400
WIRE 1136 416 1040 416
WIRE 1200 416 1136 416
WIRE 688 432 640 432
WIRE 816 432 768 432
WIRE 976 432 816 432
WIRE 816 448 816 432
WIRE 1136 448 1136 416
WIRE 448 464 416 464
WIRE 1008 496 1008 448
WIRE 1136 544 1136 512
WIRE 816 560 816 528
WIRE -448 608 -544 608
WIRE -160 608 -272 608
WIRE -448 640 -448 608
WIRE -160 640 -160 608
WIRE 416 672 416 464
WIRE 480 672 416 672
WIRE 736 672 672 672
WIRE 800 672 736 672
WIRE 912 672 880 672
WIRE 736 688 736 672
WIRE -544 704 -544 608
WIRE -272 720 -272 608
WIRE -448 752 -448 720
WIRE -160 752 -160 720
WIRE 576 768 576 736
WIRE 736 768 736 752
WIRE 736 768 576 768
WIRE 912 768 912 672
WIRE 912 768 736 768
WIRE 736 816 736 768
WIRE -544 864 -544 784
WIRE -496 864 -544 864
WIRE -448 864 -448 832
WIRE -448 864 -496 864
WIRE -160 864 -160 832
WIRE -496 896 -496 864
WIRE -272 976 -272 800
WIRE -208 976 -272 976
WIRE -160 976 -160 944
WIRE -160 976 -208 976
WIRE 304 992 208 992
WIRE 352 992 304 992
WIRE 656 992 544 992
WIRE 752 992 656 992
WIRE -208 1008 -208 976
WIRE 208 1024 208 992
WIRE 304 1056 304 992
WIRE 752 1056 752 992
WIRE 448 1088 448 1056
WIRE 656 1088 656 1072
WIRE 656 1088 448 1088
WIRE 448 1104 448 1088
WIRE -720 1120 -720 1088
WIRE 208 1216 208 1104
WIRE 304 1216 304 1120
WIRE 304 1216 208 1216
WIRE 448 1216 448 1184
WIRE 448 1216 304 1216
WIRE 752 1216 752 1120
WIRE 752 1216 448 1216
WIRE -720 1232 -720 1200
WIRE -544 1232 -720 1232
WIRE -720 1248 -720 1232
WIRE -912 1328 -1008 1328
WIRE -768 1328 -832 1328
WIRE -544 1344 -544 1312
WIRE -464 1344 -544 1344
WIRE -544 1360 -544 1344
WIRE -1008 1440 -1008 1408
WIRE -720 1440 -720 1344
WIRE -544 1472 -544 1440
FLAG 736 816 0
FLAG 752 224 0
FLAG 816 560 0
FLAG 912 208 0
FLAG 1008 496 0
FLAG 1200 416 CON
IOPIN 1200 416 Out
FLAG 1136 544 0
FLAG 1136 192 0
FLAG 752 992 Vout
FLAG -496 896 0
FLAG -208 1008 0
FLAG -720 1008 0
FLAG -544 1472 0
FLAG -1008 1440 0
FLAG -720 1440 0
FLAG -464 1344 NOT_discharge
IOPIN -464 1344 Out
SYMBOL xreg3 576 672 R0
SYMATTR InstName U1
SYMATTR Value LR8
SYMBOL Res 896 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 120
SYMBOL Cap 720 688 R0
SYMATTR InstName C1
SYMATTR Value 1µ
SYMBOL Optos/4N25 544 432 R0
SYMATTR InstName U2
SYMBOL voltage 752 320 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
SYMATTR InstName V4
SYMATTR Value 12
SYMBOL Res 784 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 6.8k
SYMBOL Res 832 544 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 4.7k
SYMBOL OpAmps/opamp2 1008 352 R0
SYMATTR InstName U3
SYMATTR Value LM339
SYMBOL Voltage 912 320 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
SYMATTR InstName V5
SYMATTR Value 3
SYMBOL Res 1120 304 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL Cap 1120 448 R0
SYMATTR InstName C2
SYMATTR Value 25p
SYMBOL Voltage 1136 304 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
SYMATTR InstName V6
SYMATTR Value 3.9
SYMBOL xreg3 448 992 R0
SYMATTR InstName U4
SYMATTR Value LR8
SYMBOL voltage 208 1008 R0
SYMATTR InstName V7
SYMATTR Value 300
SYMBOL Res 432 1088 R0
SYMATTR InstName R4
SYMATTR Value 4.3k
SYMBOL Res 640 976 R0
SYMATTR InstName R6
SYMATTR Value 1.2k
SYMBOL Cap 736 1056 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL Cap 288 1056 R0
SYMATTR InstName C4
SYMATTR Value 1µf
SYMBOL voltage -544 688 R0
SYMATTR InstName V8
SYMATTR Value 12
SYMBOL Res -464 624 R0
SYMATTR InstName R7
SYMATTR Value 6.8k
SYMBOL Res -464 736 R0
SYMATTR InstName R8
SYMATTR Value 4.7k
SYMBOL Voltage -272 704 R0
SYMATTR InstName V9
SYMATTR Value 5
SYMBOL Res -176 624 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL Res -176 736 R0
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL Res -176 848 R0
SYMATTR InstName R11
SYMATTR Value 180k
SYMBOL voltage -720 1104 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
SYMATTR InstName V10
SYMATTR Value 12
SYMBOL Res -736 1104 R0
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL nmos -768 1248 R0
SYMATTR InstName M1
SYMATTR Value 2N7002
SYMBOL Res -560 1216 R0
SYMATTR InstName R13
SYMATTR Value 8.2k
SYMBOL Res -560 1344 R0
SYMATTR InstName R14
SYMATTR Value 3.3k
SYMBOL Voltage -1008 1312 R0
SYMATTR InstName V11
SYMATTR Value PULSE(0 12 2 1n 1n 5)
SYMBOL Res -816 1312 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 1k
TEXT 608 32 Left 2 !.model MySW SW(Ron=1 Roff=1e9 Vt=2.5 VH=0)\n.include LR8.txt\n.include LM339.txt\n.tran 5
